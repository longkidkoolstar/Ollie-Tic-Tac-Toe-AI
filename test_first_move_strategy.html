<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Move Strategy Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            grid-template-rows: repeat(3, 60px);
            gap: 2px;
            margin: 20px 0;
            justify-content: center;
        }
        .cell {
            background: #e0e0e0;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        .cell:hover {
            background: #d0d0d0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .primary {
            background: #007bff;
            color: white;
        }
        .success {
            background: #28a745;
            color: white;
        }
        .danger {
            background: #dc3545;
            color: white;
        }
        .info {
            background: #17a2b8;
            color: white;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .strategy-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .toggle {
            display: inline-block;
            margin: 10px;
        }
        .toggle input[type="checkbox"] {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ First Move Strategy Test</h1>
        
        <div class="strategy-info">
            <h3>Strategy Description:</h3>
            <p><strong>When bot goes first:</strong></p>
            <ol>
                <li>Bot plays center (1,1)</li>
                <li>If opponent plays a corner, bot plays the diagonal opposite corner</li>
                <li>This creates a strong strategic position for the bot</li>
            </ol>
        </div>

        <div class="controls">
            <div class="toggle">
                <label>
                    <input type="checkbox" id="strategyEnabled" checked>
                    Enable First Move Strategy
                </label>
            </div>
            <br>
            <button class="primary" onclick="resetBoard()">Reset Board</button>
            <button class="success" onclick="testScenario1()">Test: Bot First</button>
            <button class="info" onclick="testScenario2()">Test: Opponent Corner Response</button>
            <button class="danger" onclick="clearLog()">Clear Log</button>
        </div>

        <div class="board" id="board">
            <!-- 3x3 grid will be generated by JavaScript -->
        </div>

        <div class="log" id="log">
            <strong>Test Log:</strong><br>
            Ready to test first move strategy...
        </div>
    </div>

    <script>
        // Mock BotManager for testing
        const BotManager = {
            enableFirstMoveStrategy: true,
            log: function(message) {
                const logElement = document.getElementById('log');
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `<br>[${timestamp}] ${message}`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        };

        let board = [
            ['_', '_', '_'],
            ['_', '_', '_'],
            ['_', '_', '_']
        ];

        function initBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.onclick = () => makeMove(i, j, 'o');
                    boardElement.appendChild(cell);
                }
            }
            updateDisplay();
        }

        function updateDisplay() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                cell.textContent = board[row][col] === '_' ? '' : board[row][col].toUpperCase();
                cell.style.color = board[row][col] === 'x' ? '#007bff' : '#dc3545';
            });
        }

        function makeMove(row, col, player) {
            if (board[row][col] === '_') {
                board[row][col] = player;
                BotManager.log(`${player.toUpperCase()} played at (${row},${col})`);
                updateDisplay();
            }
        }

        function resetBoard() {
            board = [
                ['_', '_', '_'],
                ['_', '_', '_'],
                ['_', '_', '_']
            ];
            updateDisplay();
            BotManager.log('Board reset');
        }

        function testScenario1() {
            resetBoard();
            BotManager.log('=== Testing Bot First Move ===');
            
            // Simulate bot's first move using strategy
            const move = getFirstMoveStrategyMove(board, 'x');
            if (move) {
                makeMove(move.row, move.col, 'x');
                BotManager.log(`‚úÖ Strategy activated: Bot played center (${move.row},${move.col})`);
            } else {
                BotManager.log('‚ùå Strategy not activated for first move');
            }
        }

        function testScenario2() {
            // Start with bot in center
            resetBoard();
            makeMove(1, 1, 'x'); // Bot center
            BotManager.log('=== Testing Opponent Corner Response ===');
            BotManager.log('Bot played center (1,1)');
            
            // Simulate opponent playing top-left corner
            makeMove(0, 0, 'o');
            BotManager.log('Opponent played corner (0,0)');
            
            // Test bot's response
            const move = getFirstMoveStrategyMove(board, 'x');
            if (move) {
                makeMove(move.row, move.col, 'x');
                BotManager.log(`‚úÖ Strategy response: Bot played diagonal corner (${move.row},${move.col})`);
            } else {
                BotManager.log('‚ùå Strategy did not respond to corner move');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<strong>Test Log:</strong><br>Log cleared...';
        }

        // Copy of the strategy functions from the userscript
        function getFirstMoveStrategyMove(board, player) {
            if (!BotManager.enableFirstMoveStrategy) return null;
            
            var totalMoves = 0;
            var opponentMoves = [];
            
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    if (board[i][j] !== '_') {
                        totalMoves++;
                        if (board[i][j] !== player) {
                            opponentMoves.push({row: i, col: j});
                        }
                    }
                }
            }

            // First move: if board is empty, play center
            if (totalMoves === 0) {
                BotManager.log('First move strategy: Playing center (1,1)');
                return { row: 1, col: 1 };
            }

            // Second move: if we played center and opponent played a corner, play diagonal corner
            if (totalMoves === 2 && board[1][1] === player && opponentMoves.length === 1) {
                var opponentMove = opponentMoves[0];
                
                var corners = [
                    {row: 0, col: 0}, {row: 0, col: 2},
                    {row: 2, col: 0}, {row: 2, col: 2}
                ];
                
                var opponentCorner = null;
                for (var k = 0; k < corners.length; k++) {
                    if (corners[k].row === opponentMove.row && corners[k].col === opponentMove.col) {
                        opponentCorner = corners[k];
                        break;
                    }
                }
                
                if (opponentCorner) {
                    var diagonalCorner = getDiagonalCorner(opponentCorner);
                    if (diagonalCorner && board[diagonalCorner.row][diagonalCorner.col] === '_') {
                        BotManager.log('First move strategy: Playing diagonal corner (' + diagonalCorner.row + ',' + diagonalCorner.col + ') opposite to opponent corner (' + opponentCorner.row + ',' + opponentCorner.col + ')');
                        return diagonalCorner;
                    }
                }
            }

            return null;
        }

        function getDiagonalCorner(corner) {
            if (corner.row === 0 && corner.col === 0) return { row: 2, col: 2 };
            if (corner.row === 0 && corner.col === 2) return { row: 2, col: 0 };
            if (corner.row === 2 && corner.col === 0) return { row: 0, col: 2 };
            if (corner.row === 2 && corner.col === 2) return { row: 0, col: 0 };
            return null;
        }

        // Event listeners
        document.getElementById('strategyEnabled').addEventListener('change', function() {
            BotManager.enableFirstMoveStrategy = this.checked;
            BotManager.log(`Strategy ${this.checked ? 'enabled' : 'disabled'}`);
        });

        // Initialize
        initBoard();
        BotManager.log('First Move Strategy Test initialized');
        BotManager.log('Click "Test: Bot First" to see the bot play center');
        BotManager.log('Click "Test: Opponent Corner Response" to see diagonal corner strategy');
    </script>
</body>
</html>
